-- ================================================= CREATE TABLES =================================================

CREATE TABLE DEPARTMENT (
  ID INT(10) NOT NULL PRIMARY KEY AUTO_INCREMENT,
  NAME VARCHAR(50)
);

CREATE TABLE CURRENT_POSITION (
  ID INT(10) NOT NULL PRIMARY KEY AUTO_INCREMENT,
  NAME VARCHAR(50),
  DEPARTMENT_ID INT(10),
  CONSTRAINT FK_CURRENT_POSITIONS_DEPARTMENT FOREIGN KEY(DEPARTMENT_ID) REFERENCES DEPARTMENT(ID)
);

CREATE TABLE AUTHORITIES (
  ID INT(10) NOT NULL PRIMARY KEY AUTO_INCREMENT,
  AUTHORITY VARCHAR(50) NOT NULL
  #   CONSTRAINT FK_AUTHORITIES_USERS FOREIGN KEY(USER_ID) REFERENCES USERS(ID)
);

CREATE TABLE USER (
  ID INT(10) NOT NULL PRIMARY KEY AUTO_INCREMENT,
  FIRST_NAME VARCHAR(30),
  LAST_NAME VARCHAR(30),
  EMAIL VARCHAR(50),
  USERNAME VARCHAR(30) NOT NULL,
  PASSWORD VARCHAR(60) NOT NULL,
  ENABLED BOOLEAN NOT NULL,
  DEPARTMENT_ID INT(10) NOT NULL,
  CURRENT_POSITION_ID INT(10) NOT NULL,
  CONSTRAINT FK_USERS_DEPARTMENT FOREIGN KEY(DEPARTMENT_ID) REFERENCES DEPARTMENT(ID),
  CONSTRAINT FK_USERS_CURRENT_POSITION FOREIGN KEY(CURRENT_POSITION_ID) REFERENCES CURRENT_POSITION(ID)
);

CREATE TABLE USERS_AUTHORITIES (
  USER_ID INT(10) NOT NULL,
  AUTHORITY_ID INT(10) NOT NULL,
  FOREIGN KEY(USER_ID) REFERENCES USER(ID),
  FOREIGN KEY(AUTHORITY_ID) REFERENCES AUTHORITIES(ID)
);

CREATE UNIQUE INDEX X_AUTH_USERNAME ON AUTHORITIES (ID, AUTHORITY);

CREATE TABLE PROJECT (
  ID INT(10) NOT NULL AUTO_INCREMENT,
  NAME VARCHAR(50),
  DESCRIPTION VARCHAR(2000),
  START_DATE DATE,
  END_DATE DATE,
  MANAGER_ID INT(10),
  PRIMARY KEY (ID),
  CONSTRAINT FK_PROJECT_MANAGER FOREIGN KEY(MANAGER_ID) REFERENCES USER(ID)
);

CREATE TABLE USERS_PROJECTS (
  USER_ID INT(10) NOT NULL,
  PROJECT_ID INT(10) NOT NULL,
  FOREIGN KEY(USER_ID) REFERENCES USER(ID),
  FOREIGN KEY(PROJECT_ID) REFERENCES PROJECT(ID)
);

-- ================================================= INSERT DATA  =================================================

INSERT INTO USERS(ID, USERNAME, PASSWORD, ENABLED) VALUES (1, 'admin', '$2a$10$Lo7mVYWfrlw16F10lZA7u.JfpZt6UPIoVeVVgmMCp1RraGcjHhp.S', true);
INSERT INTO USERS(ID, USERNAME, PASSWORD, ENABLED) VALUES (2, 'alex', '$2a$10$AywqSYqgpuRAeZc81.62L.HvRcepJu.WV/7QEiAu.htUQyWfu4cUq', true);

INSERT INTO AUTHORITIES (USER_ID, AUTHORITY) VALUE (1, 'ROLE_ADMIN');
INSERT INTO AUTHORITIES (USER_ID, AUTHORITY) VALUE (1, 'ROLE_USER');
INSERT INTO AUTHORITIES (USER_ID, AUTHORITY) VALUE (2, 'ROLE_USER');

